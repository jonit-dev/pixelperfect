name: PR Review
on:
  pull_request:
    types: [opened, synchronize, labeled, unlabeled]

permissions:
  contents: read
  pull-requests: write

jobs:
  review:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3

      - name: AI PR Review
        uses: jonit-dev/openrouter-github-action@main
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          open_router_key: ${{ secrets.OPEN_ROUTER_KEY }}
          model_id: "openai/gpt-5.1-codex-max"
          max_tokens: "4096"
          custom_prompt: |
            ### **AI PR Review Instructions**

            **Objective:**  
            Provide a clear, concise, and actionable review of the Pull Request (PR). Focus on overall codebase quality, including readability, maintainability, functionality, adherence to best practices, performance optimizations, and testing coverage. Avoid minor nitty-picky comments and repetitive feedback.

            **Focus Areas:**
            1. **Code Quality:** Assess the readability, organization, and maintainability of the code.
            2. **Functionality:** Ensure the PR meets its intended purpose and functions as expected.
            3. **Best Practices:** Evaluate adherence to coding standards, design patterns, and project guidelines.
            4. **Performance:** Identify any potential performance improvements or optimizations.
            5. **Testing:** Review the comprehensiveness and effectiveness of the test coverage.
            6. **Security:** Identify any potential security vulnerabilities or concerns.
            7. **Bugs Found:** List any bugs identified in the PR.
            8. **Issues Found:** Consolidate performance and testing issues into a unified section.

            **Critical Instructions:**
             - If you have nothing to say about a particular section, you can omit it from the review.
             - If you think there are no issues and the PR is good to go, mention it in the conclusion. No need to add unnecessary feedback. Don't be redundant.

            **Scoring Criteria:**
            - 90-100: Exceptional quality
              â€¢ Clean, efficient, and well-documented code
              â€¢ Comprehensive test coverage (>90%)
              â€¢ Follows all best practices and design patterns
              â€¢ No security vulnerabilities
              â€¢ Optimal performance considerations
              â€¢ Clear documentation and comments

            - 75-89: High quality
              â€¢ Well-structured and maintainable code
              â€¢ Good test coverage (70-90%)
              â€¢ Minor optimization opportunities
              â€¢ No critical security issues
              â€¢ Few non-critical issues
              â€¢ Adequate documentation

            - 60-74: Average quality
              â€¢ Functional but needs improvement
              â€¢ Basic test coverage (40-70%)
              â€¢ Some code duplication
              â€¢ Multiple minor issues
              â€¢ Basic security considerations
              â€¢ Limited documentation

            - 40-59: Below average
              â€¢ Significant structural issues
              â€¢ Poor test coverage (<40%)
              â€¢ Multiple security concerns
              â€¢ Performance bottlenecks
              â€¢ Inadequate error handling
              â€¢ Missing or unclear documentation

            - 0-39: Poor quality
              â€¢ Major architectural problems
              â€¢ Missing or broken tests
              â€¢ Critical security vulnerabilities
              â€¢ Severe performance issues
              â€¢ No error handling
              â€¢ No documentation
              â€¢ Breaking changes without justification

            **Review Structure:**

            1. **Overall Summary**
               - **Score:** Provide a score from 0-100.
               - **Summary:** Brief overview of the PR, highlighting its purpose and main changes.

            2. **Key Strengths**
               - Highlight 2-3 major strengths related to code quality and overall implementation.

            3. **Areas for Improvement**
               - Identify 2-3 significant areas that need enhancement, if any.
               - Provide actionable suggestions for each identified issue.

            4. **Bugs Found** (if any)
               - Present any bugs identified in the PR in a table format.
               - **Table Columns:** Bug Name, Affected Files, Description, Confidence (High ðŸŸ¢, Medium ðŸŸ¡, Low ðŸ”´)

            5. **Issues Found** (if any)
               - Consolidate performance and testing issues into a single table.
               - **Table Columns:** Issue Type, Issue Name, Affected Components, Description, Impact/Severity

            6. **Conclusion**
                - A short closing statement summarizing the overall quality of the PR and its readiness for merging.

            **Example Output:**

            ### **AI Review Summary**

            **ðŸ† Overall Score:** 85/100

            *The PR successfully implements XYZ with clean and well-structured code.*

            **âœ… Key Strengths**
            - **Feature Implementation:** Effectively adds the new feature
            - **Code Structure:** Well-organized with logical separation of concerns

            **âš ï¸ Areas for Improvement**
            - **Error Handling:** Implement more robust error handling

            **ðŸ”š Conclusion**  
            *The PR is well-executed. Addressing the highlighted issues will further strengthen the codebase.*
